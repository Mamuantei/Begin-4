"use client";

import { useState, useEffect } from "react";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Checkbox } from "@/components/ui/checkbox";
import { Badge } from "@/components/ui/badge";
import { 
  CheckCircle, 
  XCircle, 
  RotateCcw, 
  User, 
  Mail, 
  Lock, 
  Eye, 
  EyeOff,
  Trophy,
  BookOpen,
  LogOut
} from "lucide-react";

// Types
interface User {
  id: string;
  firstName: string;
  lastName: string;
  email: string;
}

interface Question {
  id: number;
  question: string;
  options: string[];
  correctAnswer: number;
  explanation: string;
}

interface FormData {
  firstName: string;
  lastName: string;
  email: string;
  password: string;
  confirmPassword: string;
  termsAccepted: boolean;
}

interface FormErrors {
  firstName?: string;
  lastName?: string;
  email?: string;
  password?: string;
  confirmPassword?: string;
  termsAccepted?: string;
}

// Quiz Data
const questions: Question[] = [
  {
    id: 1,
    question: "In what year did the American Revolution begin?",
    options: ["1773", "1775", "1776", "1777"],
    correctAnswer: 1,
    explanation:
      "The American Revolution began in 1775 with the Battles of Lexington and Concord on April 19, 1775. While the Declaration of Independence was signed in 1776, the actual fighting started a year earlier.",
  },
  {
    id: 2,
    question: "Who was the first President of the United States?",
    options: [
      "Thomas Jefferson",
      "John Adams",
      "George Washington",
      "Benjamin Franklin",
    ],
    correctAnswer: 2,
    explanation:
      "George Washington was unanimously elected as the first President of the United States in 1789. He served two terms and established many precedents for future presidents.",
  },
  {
    id: 3,
    question: "Which purchase doubled the size of the United States in 1803?",
    options: [
      "Alaska Purchase",
      "Louisiana Purchase",
      "Gadsden Purchase",
      "Texas Annexation",
    ],
    correctAnswer: 1,
    explanation:
      "The Louisiana Purchase in 1803 doubled the size of the United States. President Thomas Jefferson bought this vast territory from France for $15 million, adding about 827,000 square miles to the nation.",
  },
  {
    id: 4,
    question: "The Civil War lasted from 1861 to what year?",
    options: ["1863", "1864", "1865", "1866"],
    correctAnswer: 2,
    explanation:
      "The American Civil War ended in 1865 when Confederate General Robert E. Lee surrendered to Union General Ulysses S. Grant at Appomattox Court House on April 9, 1865.",
  },
  {
    id: 5,
    question: "Which amendment gave women the right to vote?",
    options: [
      "17th Amendment",
      "18th Amendment",
      "19th Amendment",
      "20th Amendment",
    ],
    correctAnswer: 2,
    explanation:
      "The 19th Amendment, ratified on August 18, 1920, granted women the right to vote. This was the culmination of decades of activism by suffragettes like Susan B. Anthony and Elizabeth Cady Stanton.",
  },
];

// Main App Component
export default function HistoryQuizApp() {
  const [currentUser, setCurrentUser] = useState<User | null>(null);
  const [view, setView] = useState<"welcome" | "login" | "signup" | "quiz" | "results">("welcome");
  const [quizState, setQuizState] = useState({
    currentQuestionIndex: 0,
    selectedAnswer: null as number | null,
    showExplanation: false,
    score: 0,
    quizCompleted: false,
    answeredQuestions: new Array(questions.length).fill(false),
  });
  const [formData, setFormData] = useState<FormData>({
    firstName: "",
    lastName: "",
    email: "",
    password: "",
    confirmPassword: "",
    termsAccepted: false,
  });
  const [loginData, setLoginData] = useState({ email: "", password: "" });
  const [errors, setErrors] = useState<FormErrors>({});
  const [showPassword, setShowPassword] = useState(false);
  const [showConfirmPassword, setShowConfirmPassword] = useState(false);
  const [loginError, setLoginError] = useState("");

  // Check if user is already logged in
  useEffect(() => {
    const storedUser = localStorage.getItem("quizUser");
    if (storedUser) {
      setCurrentUser(JSON.parse(storedUser));
      setView("quiz");
    }
  }, []);

  // Form validation
  const validateForm = (): boolean => {
    const newErrors: FormErrors = {};
    
    if (!formData.firstName.trim()) {
      newErrors.firstName = "First name is required";
    } else if (formData.firstName.length < 2) {
      newErrors.firstName = "First name must be at least 2 characters";
    }
    
    if (!formData.lastName.trim()) {
      newErrors.lastName = "Last name is required";
    } else if (formData.lastName.length < 2) {
      newErrors.lastName = "Last name must be at least 2 characters";
    }
    
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!formData.email) {
      newErrors.email = "Email is required";
    } else if (!emailRegex.test(formData.email)) {
      newErrors.email = "Please enter a valid email address";
    }
    
    if (!formData.password) {
      newErrors.password = "Password is required";
    } else if (formData.password.length < 8) {
      newErrors.password = "Password must be at least 8 characters";
    } else if (!/(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/.test(formData.password)) {
      newErrors.password = "Password must contain uppercase, lowercase, and number";
    }
    
    if (!formData.confirmPassword) {
      newErrors.confirmPassword = "Please confirm your password";
    } else if (formData.password !== formData.confirmPassword) {
      newErrors.confirmPassword = "Passwords do not match";
    }
    
    if (!formData.termsAccepted) {
      newErrors.termsAccepted = "You must accept the terms and conditions";
    }
    
    setErrors(newErrors);
    return Object.keys(newErrors).length === 0;
  };

  // Handle form input changes
  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const { name, value, type, checked } = e.target;
    setFormData({
      ...formData,
      [name]: type === "checkbox" ? checked : value,
    });
    
    if (errors[name as keyof FormErrors]) {
      setErrors({
        ...errors,
        [name]: undefined,
      });
    }
  };

  // Handle login input changes
  const handleLoginChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const { name, value } = e.target;
    setLoginData({
      ...loginData,
      [name]: value,
    });
    setLoginError("");
  };

  // Handle signup
  const handleSignup = (e: React.FormEvent) => {
    e.preventDefault();
    
    if (validateForm()) {
      const newUser: User = {
        id: Math.random().toString(36).substr(2, 9),
        firstName: formData.firstName,
        lastName: formData.lastName,
        email: formData.email,
      };
      
      localStorage.setItem("quizUser", JSON.stringify(newUser));
      setCurrentUser(newUser);
      setView("quiz");
      
      // Reset form
      setFormData({
        firstName: "",
        lastName: "",
        email: "",
        password: "",
        confirmPassword: "",
        termsAccepted: false,
      });
    }
  };

  // Handle login
  const handleLogin = (e: React.FormEvent) => {
    e.preventDefault();
    
    // Simple validation
    if (!loginData.email || !loginData.password) {
      setLoginError("Please enter both email and password");
      return;
    }
    
    // Simulate authentication
    const storedUser = localStorage.getItem("quizUser");
    if (storedUser) {
      const user = JSON.parse(storedUser);
      if (user.email === loginData.email) {
        setCurrentUser(user);
        setView("quiz");
        return;
      }
    }
    
    setLoginError("Invalid email or password");
  };

  // Handle logout
  const handleLogout = () => {
    localStorage.removeItem("quizUser");
    setCurrentUser(null);
    setView("welcome");
    resetQuiz();
  };

  // Quiz functions
  const handleAnswerSelect = (answerIndex: number) => {
    if (quizState.showExplanation) return;
    setQuizState(prev => ({
      ...prev,
      selectedAnswer: answerIndex
    }));
  };

  const handleSubmitAnswer = () => {
    if (quizState.selectedAnswer === null) return;

    const isCorrect = quizState.selectedAnswer === questions[quizState.currentQuestionIndex].correctAnswer;
    const newAnsweredQuestions = [...quizState.answeredQuestions];
    newAnsweredQuestions[quizState.currentQuestionIndex] = true;
    
    setQuizState(prev => ({
      ...prev,
      showExplanation: true,
      score: isCorrect ? prev.score + 1 : prev.score,
      answeredQuestions: newAnsweredQuestions
    }));
  };

  const handleNextQuestion = () => {
    if (quizState.currentQuestionIndex < questions.length - 1) {
      setQuizState(prev => ({
        ...prev,
        currentQuestionIndex: prev.currentQuestionIndex + 1,
        selectedAnswer: null,
        showExplanation: false
      }));
    } else {
      setQuizState(prev => ({
        ...prev,
        quizCompleted: true
      }));
      setView("results");
    }
  };

  const resetQuiz = () => {
    setQuizState({
      currentQuestionIndex: 0,
      selectedAnswer: null,
      showExplanation: false,
      score: 0,
      quizCompleted: false,
      answeredQuestions: new Array(questions.length).fill(false),
    });
  };

  const restartQuiz = () => {
    resetQuiz();
    setView("quiz");
  };

  // Get score message
  const getScoreMessage = () => {
    const percentage = (quizState.score / questions.length) * 100;
    if (percentage >= 80) return "Excellent! You know your American history!";
    if (percentage >= 60)
      return "Good job! You have a solid understanding of American history.";
    if (percentage >= 40)
      return "Not bad! Consider reviewing some key events in American history.";
    return "Keep studying! American history has many fascinating stories to discover.";
  };

  // Welcome View
  if (view === "welcome") {
    return (
      <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4">
        <Card className="w-full max-w-2xl">
          <CardHeader className="text-center">
            <div className="mx-auto bg-blue-100 p-4 rounded-full w-24 h-24 flex items-center justify-center mb-4">
              <BookOpen className="h-12 w-12 text-blue-600" />
            </div>
            <CardTitle className="text-3xl font-bold text-blue-800">American History Quiz</CardTitle>
            <CardDescription className="text-lg mt-2">
              Test your knowledge of American history with our interactive quiz
            </CardDescription>
          </CardHeader>
          <CardContent className="space-y-6">
            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div className="bg-blue-50 p-4 rounded-lg text-center">
                <Trophy className="h-8 w-8 text-blue-600 mx-auto mb-2" />
                <h3 className="font-semibold">8 Questions</h3>
                <p className="text-sm text-gray-600">Test your knowledge</p>
              </div>
              <div className="bg-blue-50 p-4 rounded-lg text-center">
                <BookOpen className="h-8 w-8 text-blue-600 mx-auto mb-2" />
                <h3 className="font-semibold">Detailed Explanations</h3>
                <p className="text-sm text-gray-600">Learn as you play</p>
              </div>
              <div className="bg-blue-50 p-4 rounded-lg text-center">
                <User className="h-8 w-8 text-blue-600 mx-auto mb-2" />
                <h3 className="font-semibold">Track Progress</h3>
                <p className="text-sm text-gray-600">Save your results</p>
              </div>
            </div>
            
            <div className="flex flex-col sm:flex-row gap-4 pt-4">
              <Button 
                onClick={() => setView("signup")} 
                className="flex-1"
                size="lg"
              >
                Create Account
              </Button>
              <Button 
                onClick={() => setView("login")} 
                variant="outline" 
                className="flex-1"
                size="lg"
              >
                Sign In
              </Button>
            </div>
            
            <div className="text-center text-sm text-gray-500 pt-4">
              <p>Already have an account? <Button variant="link" onClick={() => setView("login")} className="p-0 h-auto">Sign in</Button></p>
            </div>
          </CardContent>
        </Card>
      </div>
    );
  }

  // Signup View
  if (view === "signup") {
    return (
      <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4">
        <Card className="w-full max-w-md">
          <CardHeader className="text-center">
            <CardTitle className="text-2xl font-bold">Create Your Account</CardTitle>
            <CardDescription>
              Join to access our history quiz and track your progress
            </CardDescription>
          </CardHeader>
          <CardContent>
            <form onSubmit={handleSignup} className="space-y-4">
              <div className="grid grid-cols-2 gap-4">
                <div className="space-y-2">
                  <Label htmlFor="firstName">First Name</Label>
                  <div className="relative">
                    <User className="absolute left-3 top-3 h-4 w-4 text-gray-400" />
                    <Input
                      id="firstName"
                      name="firstName"
                      value={formData.firstName}
                      onChange={handleInputChange}
                      className={`pl-10 ${errors.firstName ? "border-red-500" : ""}`}
                      placeholder="John"
                    />
                  </div>
                  {errors.firstName && (
                    <p className="text-sm text-red-500">{errors.firstName}</p>
                  )}
                </div>
                
                <div className="space-y-2">
                  <Label htmlFor="lastName">Last Name</Label>
                  <div className="relative">
                    <User className="absolute left-3 top-3 h-4 w-4 text-gray-400" />
                    <Input
                      id="lastName"
                      name="lastName"
                      value={formData.lastName}
                      onChange={handleInputChange}
                      className={`pl-10 ${errors.lastName ? "border-red-500" : ""}`}
                      placeholder="Doe"
                    />
                  </div>
                  {errors.lastName && (
                    <p className="text-sm text-red-500">{errors.lastName}</p>
                  )}
                </div>
              </div>
              
              <div className="space-y-2">
                <Label htmlFor="email">Email Address</Label>
                <div className="relative">
                  <Mail className="absolute left-3 top-3 h-4 w-4 text-gray-400" />
                  <Input
                    id="email"
                    name="email"
                    type="email"
                    value={formData.email}
                    onChange={handleInputChange}
                    className={`pl-10 ${errors.email ? "border-red-500" : ""}`}
                    placeholder="john.doe@example.com"
                  />
                </div>
                {errors.email && (
                  <p className="text-sm text-red-500">{errors.email}</p>
                )}
              </div>
              
              <div className="space-y-2">
                <Label htmlFor="password">Password</Label>
                <div className="relative">
                  <Lock className="absolute left-3 top-3 h-4 w-4 text-gray-400" />
                  <Input
                    id="password"
                    name="password"
                    type={showPassword ? "text" : "password"}
                    value={formData.password}
                    onChange={handleInputChange}
                    className={`pl-10 pr-10 ${errors.password ? "border-red-500" : ""}`}
                    placeholder="••••••••"
                  />
                  <button
                    type="button"
                    onClick={() => setShowPassword(!showPassword)}
                    className="absolute right-3 top-3 text-gray-400 hover:text-gray-600"
                  >
                    {showPassword ? (
                      <EyeOff className="h-4 w-4" />
                    ) : (
                      <Eye className="h-4 w-4" />
                    )}
                  </button>
                </div>
                {errors.password && (
                  <p className="text-sm text-red-500">{errors.password}</p>
                )}
                <p className="text-xs text-gray-500">
                  Must be at least 8 characters with uppercase, lowercase, and number
                </p>
              </div>
              
              <div className="space-y-2">
                <Label htmlFor="confirmPassword">Confirm Password</Label>
                <div className="relative">
                  <Lock className="absolute left-3 top-3 h-4 w-4 text-gray-400" />
                  <Input
                    id="confirmPassword"
                    name="confirmPassword"
                    type={showConfirmPassword ? "text" : "password"}
                    value={formData.confirmPassword}
                    onChange={handleInputChange}
                    className={`pl-10 pr-10 ${errors.confirmPassword ? "border-red-500" : ""}`}
                    placeholder="••••••••"
                  />
                  <button
                    type="button"
                    onClick={() => setShowConfirmPassword(!showConfirmPassword)}
                    className="absolute right-3 top-3 text-gray-400 hover:text-gray-600"
                  >
                    {showConfirmPassword ? (
                      <EyeOff className="h-4 w-4" />
                    ) : (
                      <Eye className="h-4 w-4" />
                    )}
                  </button>
                </div>
                {errors.confirmPassword && (
                  <p className="text-sm text-red-500">{errors.confirmPassword}</p>
                )}
              </div>
              
              <div className="flex items-start space-x-2">
                <Checkbox
                  id="terms"
                  name="termsAccepted"
                  checked={formData.termsAccepted}
                  onCheckedChange={(checked) => 
                    setFormData({ ...formData, termsAccepted: checked as boolean })
                  }
                />
                <Label htmlFor="terms" className="text-sm">
                  I agree to the{" "}
                  <a href="#" className="text-blue-600 hover:underline">
                    Terms of Service
                  </a>{" "}
                  and{" "}
                  <a href="#" className="text-blue-600 hover:underline">
                    Privacy Policy
                  </a>
                </Label>
              </div>
              {errors.termsAccepted && (
                <p className="text-sm text-red-500">{errors.termsAccepted}</p>
              )}
              
              <Button 
                type="submit" 
                className="w-full"
              >
                Create Account
              </Button>
            </form>
            
            <div className="mt-6 text-center text-sm">
              <p className="text-gray-600">
                Already have an account?{" "}
                <Button 
                  variant="link" 
                  onClick={() => setView("login")} 
                  className="p-0 h-auto font-medium"
                >
                  Sign in
                </Button>
              </p>
            </div>
          </CardContent>
        </Card>
      </div>
    );
  }

  // Login View
  if (view === "login") {
    return (
      <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4">
        <Card className="w-full max-w-md">
          <CardHeader className="text-center">
            <CardTitle className="text-2xl font-bold">Sign In to Your Account</CardTitle>
            <CardDescription>
              Access your history quiz progress
            </CardDescription>
          </CardHeader>
          <CardContent>
            <form onSubmit={handleLogin} className="space-y-4">
              <div className="space-y-2">
                <Label htmlFor="loginEmail">Email Address</Label>
                <div className="relative">
                  <Mail className="absolute left-3 top-3 h-4 w-4 text-gray-400" />
                  <Input
                    id="loginEmail"
                    name="email"
                    type="email"
                    value={loginData.email}
                    onChange={handleLoginChange}
                    className="pl-10"
                    placeholder="john.doe@example.com"
                  />
                </div>
              </div>
              
              <div className="space-y-2">
                <Label htmlFor="loginPassword">Password</Label>
                <div className="relative">
                  <Lock className="absolute left-3 top-3 h-4 w-4 text-gray-400" />
                  <Input
                    id="loginPassword"
                    name="password"
                    type="password"
                    value={loginData.password}
                    onChange={handleLoginChange}
                    className="pl-10"
                    placeholder="••••••••"
                  />
                </div>
              </div>
              
              {loginError && (
                <p className="text-sm text-red-500">{loginError}</p>
              )}
              
              <Button 
                type="submit" 
                className="w-full"
              >
                Sign In
              </Button>
            </form>
            
            <div className="mt-6 text-center text-sm">
              <p className="text-gray-600">
                Don't have an account?{" "}
                <Button 
                  variant="link" 
                  onClick={() => setView("signup")} 
                  className="p-0 h-auto font-medium"
                >
                  Create one
                </Button>
              </p>
            </div>
          </CardContent>
        </Card>
      </div>
    );
  }

  // Quiz View
  if (view === "quiz") {
    const question = questions[quizState.currentQuestionIndex];
    const isCorrect = quizState.selectedAnswer === question.correctAnswer;
    
    return (
      <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
        <div className="max-w-4xl mx-auto">
          {/* Header */}
          <div className="flex justify-between items-center mb-6">
            <h1 className="text-2xl font-bold text-blue-800">American History Quiz</h1>
            <div className="flex items-center space-x-4">
              <Badge variant="secondary">
                {currentUser?.firstName} {currentUser?.lastName}
              </Badge>
              <Button 
                variant="outline" 
                size="sm" 
                onClick={handleLogout}
                className="flex items-center gap-1"
              >
                <LogOut className="h-4 w-4" />
                Logout
              </Button>
            </div>
          </div>
          
          {/* Progress and Score */}
          <div className="mb-6 flex items-center justify-between">
            <Badge variant="outline" className="text-sm">
              Question {quizState.currentQuestionIndex + 1} of {questions.length}
            </Badge>
            <Badge variant="secondary" className="text-sm">
              Score: {quizState.score}/{questions.length}
            </Badge>
          </div>
          
          {/* Progress Bar */}
          <div className="mb-8 h-2 w-full rounded-full bg-gray-200">
            <div
              className="h-2 rounded-full bg-blue-600 transition-all duration-300"
              style={{
                width: `${((quizState.currentQuestionIndex + 1) / questions.length) * 100}%`,
              }}
            ></div>
          </div>
          
          {/* Question Card */}
          <Card className="mb-6">
            <CardHeader>
              <CardTitle className="text-xl">{question.question}</CardTitle>
            </CardHeader>
            <CardContent className="space-y-4">
              {/* Answer Options */}
              <div className="grid gap-3">
                {question.options.map((option, index) => (
                  <button
                    key={index}
                    onClick={() => handleAnswerSelect(index)}
                    disabled={quizState.showExplanation}
                    className={`rounded-lg border-2 p-4 text-left transition-all duration-200 ${
                      quizState.selectedAnswer === index
                        ? quizState.showExplanation
                          ? index === question.correctAnswer
                            ? "border-green-500 bg-green-50 text-green-800"
                            : "border-red-500 bg-red-50 text-red-800"
                          : "border-blue-500 bg-blue-50"
                        : quizState.showExplanation && index === question.correctAnswer
                          ? "border-green-500 bg-green-50 text-green-800"
                          : "border-gray-200 hover:border-gray-300 hover:bg-gray-50"
                    } ${quizState.showExplanation ? "cursor-default" : "cursor-pointer"}`}
                  >
                    <div className="flex items-center justify-between">
                      <span>{option}</span>
                      {quizState.showExplanation && (
                        <div>
                          {index === question.correctAnswer && (
                            <CheckCircle className="h-5 w-5 text-green-600" />
                          )}
                          {quizState.selectedAnswer === index &&
                            index !== question.correctAnswer && (
                              <XCircle className="h-5 w-5 text-red-600" />
                            )}
                        </div>
                      )}
                    </div>
                  </button>
                ))}
              </div>
              
              {/* Explanation */}
              {quizState.showExplanation && (
                <div
                  className={`rounded-lg p-4 ${isCorrect ? "border border-green-200 bg-green-50" : "border border-red-200 bg-red-50"}`}
                >
                  <div className="flex items-start gap-3">
                    {isCorrect ? (
                      <CheckCircle className="mt-0.5 h-6 w-6 flex-shrink-0 text-green-600" />
                    ) : (
                      <XCircle className="mt-0.5 h-6 w-6 flex-shrink-0 text-red-600" />
                    )}
                    <div>
                      <p
                        className={`mb-2 font-semibold ${isCorrect ? "text-green-800" : "text-red-800"}`}
                      >
                        {isCorrect ? "Correct!" : "Incorrect!"}
                      </p>
                      <p className="text-gray-700">{question.explanation}</p>
                    </div>
                  </div>
                </div>
              )}
              
              {/* Action Buttons */}
              <div className="flex gap-3 pt-4">
                {!quizState.showExplanation ? (
                  <Button
                    onClick={handleSubmitAnswer}
                    disabled={quizState.selectedAnswer === null}
                    className="flex-1"
                  >
                    Submit Answer
                  </Button>
                ) : (
                  <Button onClick={handleNextQuestion} className="flex-1">
                    {quizState.currentQuestionIndex < questions.length - 1
                      ? "Next Question"
                      : "View Results"}
                  </Button>
                )}
              </div>
            </CardContent>
          </Card>
        </div>
      </div>
    );
  }

  // Results View
  if (view === "results") {
    const percentage = (quizState.score / questions.length) * 100;
    const getScoreColor = () => {
      if (percentage >= 80) return "bg-green-500";
      if (percentage >= 60) return "bg-yellow-500";
      return "bg-red-500";
    };
    
    return (
      <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4">
        <Card className="w-full max-w-2xl">
          <CardHeader className="text-center">
            <CardTitle className="text-3xl font-bold text-blue-800">
              Quiz Complete!
            </CardTitle>
            <CardDescription className="text-lg">
              Here are your results, {currentUser?.firstName}
            </CardDescription>
          </CardHeader>
          <CardContent className="space-y-6">
            <div className="text-center">
              <div
                className={`inline-flex h-24 w-24 items-center justify-center rounded-full ${getScoreColor()} mb-4 text-2xl font-bold text-white`}
              >
                {quizState.score}/{questions.length}
              </div>
              <p className="mb-2 text-xl font-semibold">
                You scored {Math.round(percentage)}%
              </p>
              <p className="text-muted-foreground">{getScoreMessage()}</p>
            </div>
            
            <div className="space-y-2">
              <h3 className="text-lg font-semibold">Question Breakdown:</h3>
              <div className="grid grid-cols-4 gap-2">
                {questions.map((_, index) => (
                  <div
                    key={index}
                    className={`rounded p-2 text-center text-sm font-medium ${
                      quizState.answeredQuestions[index]
                        ? "bg-green-100 text-green-800"
                        : "bg-gray-100 text-gray-600"
                    }`}
                  >
                    Q{index + 1}
                  </div>
                ))}
              </div>
            </div>
            
            <div className="flex gap-3">
              <Button onClick={restartQuiz} className="flex-1">
                <RotateCcw className="mr-2 h-4 w-4" />
                Take Quiz Again
              </Button>
              <Button 
                variant="outline" 
                onClick={handleLogout}
                className="flex-1"
              >
                Logout
              </Button>
            </div>
          </CardContent>
        </Card>
      </div>
    );
  }
  
  return null;
}
